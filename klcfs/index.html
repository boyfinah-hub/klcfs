<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KLCDO Development Finance System (KDFS)</title>
<!-- QR Code Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<!-- Font Awesome for Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
--primary: #4361ee;
--primary-dark: #3a56d4;
--secondary: #7209b7;
--accent: #06d6a0;
--warning: #ffd166;
--danger: #ef476f;
--light: #f8f9fc;
--dark: #1e293b;
--white: #ffffff;
--gray: #64748b;
--success: #10b981;
--gradient-1: linear-gradient(135deg, #4361ee, #3a0ca3);
--gradient-2: linear-gradient(135deg, #06d6a0, #118ab2);
--gradient-3: linear-gradient(135deg, #ef476f, #ffd166);
--shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
--shadow-md: 0 4px 12px rgba(0,0,0,0.1);
--shadow-lg: 0 10px 25px rgba(0,0,0,0.15);
--shadow-xl: 0 20px 40px rgba(0,0,0,0.2);
--radius-sm: 8px;
--radius-md: 16px;
--radius-lg: 24px;
--radius-full: 9999px;
--transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
* {
box-sizing: border-box;
margin: 0;
padding: 0;
font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
}
body {
background: var(--light);
color: var(--dark);
min-height: 100vh;
display: flex;
flex-direction: column;
overflow-x: hidden;
}
/* Animated Background */
body::before {
content: "";
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background:
radial-gradient(circle at 10% 20%, rgba(67, 97, 238, 0.1) 0%, transparent 25%),
radial-gradient(circle at 90% 80%, rgba(114, 9, 183, 0.1) 0%, transparent 25%),
radial-gradient(circle at 50% 50%, rgba(6, 214, 160, 0.08) 0%, transparent 35%);
z-index: -1;
animation: pulse 15s infinite alternate;
}
@keyframes pulse {
0% { opacity: 0.7; }
100% { opacity: 1; }
}
/* Utilities */
.hidden { display: none !important; }
.flex { display: flex; gap: 12px; flex-wrap: wrap; }
.flex-center { display: flex; align-items: center; justify-content: center; }
.flex-between { display: flex; align-items: center; justify-content: space-between; }
.grid { display: grid; gap: 20px; }
.grid-2 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
.grid-3 { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
.btn {
padding: 12px 24px;
border: none;
border-radius: var(--radius-full);
cursor: pointer;
font-weight: 600;
transition: var(--transition);
display: inline-flex;
align-items: center;
justify-content: center;
gap: 8px;
font-size: 1rem;
box-shadow: var(--shadow-sm);
}
.btn:hover {
transform: translateY(-2px);
box-shadow: var(--shadow-md);
}
.btn:active { transform: translateY(0); }
.btn-primary {
background: var(--gradient-1);
color: var(--white);
}
.btn-primary:hover {
background: linear-gradient(135deg, #3a56d4, #300a8a);
box-shadow: 0 6px 16px rgba(58, 86, 212, 0.4);
}
.btn-success {
background: var(--gradient-2);
color: var(--white);
}
.btn-success:hover {
background: linear-gradient(135deg, #05c490, #0e7a96);
box-shadow: 0 6px 16px rgba(6, 214, 160, 0.4);
}
.btn-danger {
background: var(--gradient-3);
color: var(--white);
}
.btn-danger:hover {
background: linear-gradient(135deg, #e03a5a, #e6b800);
box-shadow: 0 6px 16px rgba(239, 71, 111, 0.4);
}
.btn-outline {
border: 2px solid var(--primary);
color: var(--primary);
background: transparent;
font-weight: 600;
}
.btn-outline:hover {
background: rgba(67, 97, 238, 0.1);
}
.btn-sm { padding: 8px 16px; font-size: 0.9rem; }
.btn-block { width: 100%; }
.container {
max-width: 1200px;
margin: 0 auto;
padding: 20px;
width: 100%;
}
.card {
background: var(--white);
padding: 24px;
border-radius: var(--radius-lg);
box-shadow: var(--shadow-lg);
margin-bottom: 20px;
transition: var(--transition);
border: 1px solid rgba(0,0,0,0.05);
}
.card:hover {
transform: translateY(-4px);
box-shadow: var(--shadow-xl);
}
/* Header */
header {
background: var(--gradient-1);
color: var(--white);
padding: 16px 0;
position: sticky;
top: 0;
z-index: 100;
box-shadow: var(--shadow-md);
}
.nav-flex {
display: flex;
justify-content: space-between;
align-items: center;
padding: 0 20px;
}
.logo {
display: flex;
align-items: center;
gap: 12px;
font-weight: 700;
font-size: 1.5rem;
}
.logo i {
font-size: 1.8rem;
}
/* Auth Forms - Enhanced Login Page */
.auth-container {
max-width: 480px;
margin: 40px auto;
animation: slideUp 0.5s ease-out;
}
@keyframes slideUp {
from { opacity: 0; transform: translateY(30px); }
to { opacity: 1; transform: translateY(0); }
}
.auth-card {
background: var(--green);
border-radius: var(--radius-lg);
box-shadow: var(--shadow-xl);
padding: 40px 32px;
position: relative;
overflow: hidden;
border: 1px solid rgba(0,0,0,0.08);
}
.auth-card::before {
content: "";
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 6px;
background: var(--gradient-2);
}
.auth-title {
text-align: center;
margin-bottom: 32px;
font-weight: 700;
font-size: 1.8rem;
color: var(--dark);
position: relative;
padding-bottom: 16px;
}
.auth-title::after {
content: "";
position: absolute;
bottom: 0;
left: 50%;
transform: translateX(-50%);
width: 60px;
height: 4px;
background: var(--gradient-1);
border-radius: 2px;
}
.form-group {
margin-bottom: 20px;
position: relative;
}
.form-group label {
display: block;
margin-bottom: 8px;
font-weight: 600;
color: var(--dark);
font-size: 0.95rem;
}
.form-control {
width: 100%;
padding: 14px 16px;
border: 2px solid #e2e8f0;
border-radius: var(--radius-md);
font-size: 1rem;
transition: var(--transition);
background: var(--white);
}
.form-control:focus {
outline: none;
border-color: var(--primary);
box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
}
.form-control::placeholder {
color: var(--gray);
}
.input-icon {
position: absolute;
right: 16px;
top: 42px;
color: var(--gray);
font-size: 1.1rem;
}
.auth-footer {
text-align: center;
margin-top: 24px;
padding-top: 20px;
border-top: 1px solid #eee;
}
.auth-toggle {
color: var(--primary);
text-decoration: none;
font-weight: 600;
transition: var(--transition);
display: inline-flex;
align-items: center;
gap: 4px;
}
.auth-toggle:hover {
color: var(--primary-dark);
text-decoration: underline;
}
.social-login {
margin-top: 24px;
text-align: center;
}
.social-login p {
color: var(--gray);
margin-bottom: 16px;
position: relative;
}
.social-login p::before,
.social-login p::after {
content: "";
position: absolute;
top: 50%;
width: 30%;
height: 1px;
background: #e2e8f0;
}
.social-login p::before { left: 0; }
.social-login p::after { right: 0; }
.social-btn {
display: inline-flex;
align-items: center;
justify-content: center;
gap: 10px;
padding: 12px;
border: 2px solid #e2e8f0;
border-radius: var(--radius-md);
background: var(--white);
width: 100%;
max-width: 200px;
margin: 0 8px 12px;
font-weight: 600;
transition: var(--transition);
color: var(--dark);
}
.social-btn:hover {
border-color: var(--primary);
transform: translateY(-2px);
box-shadow: var(--shadow-md);
}
.social-btn.google { color: #db4437; }
.social-btn.apple { color: #000; }
/* Dashboard */
.profile-section {
display: flex;
align-items: center;
gap: 20px;
padding: 16px;
background: rgba(67, 97, 238, 0.05);
border-radius: var(--radius-md);
}
.profile-pic {
width: 90px;
height: 90px;
border-radius: var(--radius-full);
object-fit: cover;
border: 4px solid var(--primary);
background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
box-shadow: var(--shadow-md);
display: flex;
align-items: center;
justify-content: center;
font-size: 2.5rem;
color: var(--primary);
font-weight: bold;
}
.stats-badge {
background: linear-gradient(135deg, var(--primary), var(--secondary));
color: white;
padding: 6px 16px;
border-radius: var(--radius-full);
font-size: 0.9rem;
font-weight: 600;
display: inline-flex;
align-items: center;
gap: 6px;
box-shadow: 0 4px 10px rgba(67, 97, 238, 0.3);
}
.growth-positive {
color: var(--success);
font-weight: 700;
display: flex;
align-items: center;
gap: 4px;
}
.growth-negative {
color: var(--danger);
font-weight: 700;
display: flex;
align-items: center;
gap: 4px;
}
/* Portfolios */
.portfolio-card {
border-left: 5px solid var(--primary);
transition: var(--transition);
position: relative;
overflow: hidden;
}
.portfolio-card::after {
content: "";
position: absolute;
top: 0;
right: 0;
width: 100%;
height: 4px;
background: var(--gradient-1);
opacity: 0.2;
}
.portfolio-card:hover {
transform: translateY(-4px);
box-shadow: var(--shadow-xl);
}
.portfolio-header {
display: flex;
justify-content: space-between;
align-items: center;
padding-bottom: 12px;
border-bottom: 1px solid #f1f5f9;
margin-bottom: 12px;
}
.portfolio-icon {
width: 48px;
height: 48px;
border-radius: var(--radius-md);
display: flex;
align-items: center;
justify-content: center;
font-size: 1.5rem;
background: rgba(67, 97, 238, 0.1);
color: var(--primary);
margin-right: 12px;
}
.percentage-bar {
height: 8px;
background: #e2e8f0;
border-radius: 4px;
margin: 12px 0;
overflow: hidden;
}
.percentage-fill {
height: 100%;
background: var(--gradient-1);
border-radius: 4px;
width: 0%;
transition: width 0.5s ease;
}
.percentage-text {
font-size: 0.9rem;
color: var(--gray);
margin-top: 4px;
display: flex;
justify-content: space-between;
}
.growth-indicator {
font-size: 0.95rem;
margin-top: 8px;
display: flex;
align-items: center;
gap: 6px;
}
/* Quick Actions */
.action-btn {
width: 100%;
padding: 18px;
margin-bottom: 12px;
font-size: 1.1rem;
display: flex;
align-items: center;
justify-content: center;
gap: 10px;
font-weight: 600;
box-shadow: var(--shadow-md);
}
.action-btn i {
font-size: 1.4rem;
}
/* Modals */
.modal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0,0,0,0.6);
display: flex;
justify-content: center;
align-items: center;
z-index: 1000;
opacity: 0;
visibility: hidden;
transition: var(--transition);
backdrop-filter: blur(4px);
}
.modal.active {
opacity: 1;
visibility: visible;
}
.modal-content {
background: var(--white);
padding: 32px;
border-radius: var(--radius-lg);
width: 90%;
max-width: 520px;
position: relative;
transform: translateY(20px);
transition: transform 0.4s ease;
box-shadow: var(--shadow-xl);
border: 1px solid rgba(0,0,0,0.1);
}
.modal.active .modal-content {
transform: translateY(0);
}
.close-modal {
position: absolute;
top: 16px;
right: 20px;
font-size: 1.8rem;
cursor: pointer;
color: var(--gray);
width: 36px;
height: 36px;
border-radius: var(--radius-full);
display: flex;
align-items: center;
justify-content: center;
transition: var(--transition);
}
.close-modal:hover {
background: #f1f5f9;
color: var(--danger);
transform: rotate(90deg);
}
/* Toast Notification - Enhanced */
.toast {
position: fixed;
bottom: 30px;
right: 30px;
background: var(--white);
color: var(--dark);
padding: 16px 24px;
border-radius: var(--radius-md);
transform: translateX(200%);
transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
z-index: 2000;
box-shadow: var(--shadow-xl);
display: flex;
align-items: center;
gap: 12px;
max-width: 380px;
border-left: 4px solid var(--success);
font-weight: 500;
}
.toast.show {
transform: translateX(0);
}
.toast.success {
border-left-color: var(--success);
background: linear-gradient(to right, #f0fdf4, var(--white));
}
.toast.success i {
color: var(--success);
font-size: 1.4rem;
}
.toast.error {
border-left-color: var(--danger);
background: linear-gradient(to right, #fef2f2, var(--white));
}
.toast.error i {
color: var(--danger);
font-size: 1.4rem;
}
.toast.warning {
border-left-color: var(--warning);
background: linear-gradient(to right, #fffbeb, var(--white));
}
.toast.warning i {
color: #d97706;
font-size: 1.4rem;
}
.toast-content {
flex: 1;
}
.toast-title {
font-weight: 700;
margin-bottom: 4px;
display: block;
}
.toast-message {
font-size: 0.95rem;
color: var(--gray);
}
/* QR Code Modal */
.qr-container {
display: flex;
flex-direction: column;
align-items: center;
text-align: center;
padding: 20px 0;
}
#qrcode {
margin: 20px 0;
padding: 16px;
background: var(--white);
border-radius: var(--radius-md);
box-shadow: var(--shadow-md);
display: inline-block;
}
.qr-details {
background: #f8fafc;
border-radius: var(--radius-md);
padding: 16px;
width: 100%;
margin: 16px 0;
text-align: left;
border: 1px solid #e2e8f0;
}
.qr-detail-row {
display: flex;
justify-content: space-between;
padding: 8px 0;
border-bottom: 1px dashed #e2e8f0;
}
.qr-detail-row:last-child {
border-bottom: none;
}
.qr-detail-label {
font-weight: 600;
color: var(--gray);
}
.qr-detail-value {
font-weight: 700;
color: var(--primary);
}
.qr-instruction {
background: rgba(6, 214, 160, 0.1);
color: #0e7a66;
padding: 12px;
border-radius: var(--radius-md);
margin: 16px 0;
font-size: 0.95rem;
display: flex;
align-items: center;
gap: 10px;
}
/* Receipt Print Style */
#receipt-area { display: none; }
@media print {
body * { visibility: hidden; }
#receipt-area, #receipt-area * { visibility: visible; }
#receipt-area {
display: block;
position: absolute;
left: 0;
top: 0;
width: 100%;
padding: 20px;
background: white;
}
.no-print { display: none; }
.receipt-container {
max-width: 400px;
margin: 0 auto;
border: 3px solid var(--primary);
border-radius: 16px;
padding: 24px;
text-align: center;
}
.receipt-header {
margin-bottom: 20px;
padding-bottom: 16px;
border-bottom: 2px dashed #e2e8f0;
}
.receipt-logo {
font-size: 1.8rem;
font-weight: 800;
color: var(--primary);
margin-bottom: 8px;
}
.receipt-title {
font-size: 1.4rem;
font-weight: 700;
margin: 8px 0;
}
.receipt-detail {
display: flex;
justify-content: space-between;
margin: 10px 0;
font-size: 1.05rem;
}
.receipt-amount {
font-size: 2rem;
font-weight: 800;
color: var(--success);
margin: 16px 0;
text-align: center;
}
.receipt-qr {
margin: 20px 0;
display: flex;
justify-content: center;
}
.receipt-footer {
margin-top: 24px;
padding-top: 16px;
border-top: 2px dashed #e2e8f0;
font-size: 0.9rem;
color: var(--gray);
}
}
/* Reports Section */
.report-btn {
width: 100%;
margin-bottom: 8px;
text-align: left;
padding: 14px 20px;
display: flex;
align-items: center;
gap: 12px;
font-weight: 500;
transition: var(--transition);
}
.report-btn:hover {
background: rgba(67, 97, 238, 0.08);
transform: translateX(4px);
}
.report-btn i {
font-size: 1.2rem;
width: 24px;
text-align: center;
}
/* Animations */
@keyframes float {
0%, 100% { transform: translateY(0); }
50% { transform: translateY(-10px); }
}
.floating {
animation: float 6s ease-in-out infinite;
}
.pulse {
animation: pulse-animation 2s infinite;
}
@keyframes pulse-animation {
0% { box-shadow: 0 0 0 0 rgba(67, 97, 238, 0.4); }
70% { box-shadow: 0 0 0 12px rgba(67, 97, 238, 0); }
100% { box-shadow: 0 0 0 0 rgba(67, 97, 238, 0); }
}
/* Responsive */
@media (max-width: 768px) {
.nav-flex {
flex-direction: column;
gap: 16px;
padding: 12px 20px;
}
.auth-card {
padding: 32px 24px;
margin: 20px;
}
.grid-2, .grid-3 {
grid-template-columns: 1fr;
}
.profile-section {
flex-direction: column;
text-align: center;
}
.toast {
left: 20px;
right: 20px;
bottom: 20px;
max-width: none;
}
}
/* Loading Animation */
.loading {
display: inline-block;
width: 20px;
height: 20px;
border: 3px solid rgba(255,255,255,0.3);
border-radius: 50%;
border-top-color: white;
animation: spin 1s linear infinite;
margin-right: 8px;
}
@keyframes spin {
to { transform: rotate(360deg); }
}
.btn.loading {
position: relative;
color: transparent !important;
}
.btn.loading::after {
content: "";
position: absolute;
width: 20px;
height: 20px;
border: 3px solid rgba(255,255,255,0.3);
border-radius: 50%;
border-top-color: white;
animation: spin 1s linear infinite;
}
/* Print Confirmation Modal */
.print-confirm-btn {
margin: 10px 5px;
min-width: 140px;
}
/* Live Clock */
.live-clock {
font-size: 0.9rem;
opacity: 0.9;
margin-top: 4px;
}
/* Alarm Indicator */
.alarm-indicator {
position: fixed;
top: 80px;
right: 20px;
background: var(--warning);
color: var(--dark);
padding: 12px 20px;
border-radius: var(--radius-md);
box-shadow: var(--shadow-lg);
display: flex;
align-items: center;
gap: 10px;
font-weight: 600;
z-index: 999;
animation: slideIn 0.5s ease-out;
}
@keyframes slideIn {
from { transform: translateX(100%); opacity: 0; }
to { transform: translateX(0); opacity: 1; }
}
.alarm-indicator i {
font-size: 1.4rem;
animation: ring 0.5s ease-in-out;
}
@keyframes ring {
0%, 100% { transform: rotate(0); }
25% { transform: rotate(-15deg); }
75% { transform: rotate(15deg); }
}
</style>
</head>
<body>
<!-- Audio Elements for Alarms -->
<audio id="login-sound" preload="auto">
<source src="data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU" type="audio/wav">
</audio>
<audio id="transaction-sound" preload="auto">
<source src="data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU" type="audio/wav">
</audio>

<!-- Header -->
<header>
<div class="container nav-flex">
<div class="logo">
<i class="fas fa-landmark"></i>
<span>KLCDO Development Finance System (KDFS)</span>
</div>
<div id="nav-links" class="hidden flex">
<span id="header-member-name" style="margin-right: 15px; font-weight: 500;"></span>
<span id="live-clock" class="live-clock"></span>
<button class="btn btn-outline" style="border-color: white; color: white;" onclick="logout()">
<i class="fas fa-sign-out-alt"></i> Logout
</button>
</div>
</div>
</header>

<!-- Auth Section - Enhanced Login Page -->
<div id="auth-section" class="container">
<div class="card auth-container">
<div class="auth-card">
<h3 id="auth-title" class="auth-title">Member Login</h3>
<form id="auth-form">
<div class="form-group" id="name-group" class="hidden">
<label><i class="fas fa-user me-2"></i> Full Name</label>
<input type="text" id="reg-name" class="form-control" placeholder="Enter your full name">
<i class="fas fa-user input-icon"></i>
</div>
<div class="form-group">
<label><i class="fas fa-id-card me-2"></i> Member ID</label>
<input type="text" id="member-id" class="form-control" placeholder="Enter Member ID" required>
<i class="fas fa-id-badge input-icon"></i>
</div>
<div class="form-group">
<label><i class="fas fa-lock me-2"></i> Password</label>
<input type="password" id="password" class="form-control" placeholder="Enter Password" required>
<i class="fas fa-key input-icon"></i>
</div>
<button type="submit" class="btn btn-primary btn-block" id="auth-submit">
<i class="fas fa-sign-in-alt"></i> Sign In
</button>
</form>
<div class="social-login">
<p>Or continue with</p>
<div class="flex-center">
<button class="social-btn google">
<i class="fab fa-google"></i> Google
</button>
<button class="social-btn apple">
<i class="fab fa-apple"></i> Apple
</button>
</div>
</div>
<div class="auth-footer">
<p>Don't have an account?
<a href="#" class="auth-toggle" id="auth-toggle">
<i class="fas fa-user-plus"></i> Create Account
</a>
</p>
<p style="margin-top: 12px; font-size: 0.9rem; color: var(--gray);">
<a href="#" style="color: var(--primary); text-decoration: none;">Forgot Password?</a>
</p>
</div>
</div>
</div>
</div>

<!-- Dashboard Section -->
<div id="dashboard-section" class="container hidden">
<!-- Profile & Overview -->
<div class="grid grid-3">
<div class="card">
<div class="profile-section">
<div class="profile-pic" id="display-profile-pic">U</div>
<div>
<h3 id="dash-name">Member Name</h3>
<p style="color: var(--gray);">ID: <span id="dash-id" style="font-weight: 600;">********</span></p>
<span class="stats-badge">
<i class="fas fa-crown"></i> KLCDO Member
</span>
</div>
</div>
<div style="margin-top: 20px; text-align: center;">
<button class="btn btn-outline" onclick="openModal('profile-modal')">
<i class="fas fa-camera"></i> Update Profile
</button>
</div>
</div>
<div class="card">
<h3><i class="fas fa-wallet me-2"></i> Total Portfolio Value</h3>
<h1 style="color: var(--primary); margin: 15px 0; font-size: 2.2rem;" id="total-portfolio">UGX 0</h1>
<p class="growth-indicator">
<i class="fas fa-chart-line"></i> Projected Annual Return:
<span class="growth-positive"><i class="fas fa-arrow-up"></i> +12.5%</span>
</p>
<div style="margin-top: 20px;" class="flex">
<button class="btn btn-success" onclick="openModal('deposit-modal')" style="flex:1">
<i class="fas fa-plus-circle"></i> Deposit
</button>
<button class="btn btn-danger" onclick="openModal('withdraw-modal')" style="flex:1">
<i class="fas fa-minus-circle"></i> Withdraw
</button>
</div>
</div>
<div class="card">
<h3><i class="fas fa-file-alt me-2"></i> Reports & Statements</h3>
<div style="margin-top: 15px;">
<button class="btn btn-outline report-btn" onclick="downloadReport('weekly')">
<i class="fas fa-download"></i> Weekly Report
</button>
<button class="btn btn-outline report-btn" onclick="downloadReport('monthly')">
<i class="fas fa-download"></i> Monthly Report
</button>
<button class="btn btn-outline report-btn" onclick="downloadReport('yearly')">
<i class="fas fa-download"></i> Yearly Report
</button>
<button class="btn btn-outline report-btn" onclick="viewStatements()">
<i class="fas fa-history"></i> Transaction History
</button>
</div>
</div>
</div>

<!-- Investment Portfolios -->
<h3 style="margin: 30px 0 20px; display: flex; align-items: center; gap: 10px;">
<i class="fas fa-chart-pie"></i> Investment Portfolios
</h3>
<div class="grid grid-3" id="portfolio-grid">
<!-- Portfolios injected via JS -->
</div>

<!-- Quick Actions -->
<h3 style="margin: 30px 0 20px; display: flex; align-items: center; gap: 10px;">
<i class="fas fa-bolt"></i> Quick Actions
</h3>
<div class="grid grid-3">
<button class="btn btn-primary action-btn" onclick="openModal('transfer-modal')">
<i class="fas fa-exchange-alt"></i> Transfer Funds
</button>
<button class="btn btn-outline action-btn" onclick="viewStatements()">
<i class="fas fa-list"></i> View History
</button>
<button class="btn btn-outline action-btn" onclick="showCardDetails()">
<i class="fas fa-credit-card"></i> Manage Smart Card
</button>
</div>
</div>

<!-- Modals -->
<!-- Profile Upload Modal -->
<div id="profile-modal" class="modal">
<div class="modal-content">
<span class="close-modal" onclick="closeModal('profile-modal')">&times;</span>
<h3 style="margin-bottom: 24px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px;">
<i class="fas fa-user-circle"></i> Update Profile Picture
</h3>
<div class="form-group" style="margin-top: 15px; text-align: center;">
<div class="profile-pic" style="margin: 0 auto 20px; width: 120px; height: 120px; font-size: 3rem;" id="preview-profile-pic">U</div>
<input type="file" id="profile-upload" class="form-control" accept="image/*" style="max-width: 300px; margin: 0 auto;">
<p style="color: var(--gray); font-size: 0.9rem; margin-top: 8px;">Recommended: Square image, at least 400x400px</p>
</div>
<button class="btn btn-primary btn-block" onclick="uploadProfile()" style="margin-top: 10px;">
<i class="fas fa-save"></i> Save Picture
</button>
</div>
</div>

<!-- Deposit Modal -->
<div id="deposit-modal" class="modal">
<div class="modal-content">
<span class="close-modal" onclick="closeModal('deposit-modal')">&times;</span>
<h3 style="margin-bottom: 24px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px;">
<i class="fas fa-plus-circle"></i> Deposit Money
</h3>
<div class="form-group">
<label><i class="fas fa-layer-group me-2"></i> Select Investment Type</label>
<select id="deposit-type" class="form-control">
<option value="Labor">üí™ Labor</option>
<option value="Cash">üíµ Cash</option>
<option value="Material">üì¶ Material</option>
<option value="Schools">üéì Schools</option>
<option value="Hospitals">üè• Hospitals</option>
<option value="Business">üíº Business Communities</option>
</select>
</div>
<div class="form-group">
<label><i class="fas fa-coins me-2"></i> Amount (UGX)</label>
<input type="number" id="deposit-amount" class="form-control" min="1000" placeholder="Min UGX 1,000">
</div>
<button class="btn btn-success btn-block" onclick="processTransaction('deposit')" id="deposit-btn">
<i class="fas fa-check-circle"></i> Verify & Deposit
</button>
<p style="text-align: center; margin-top: 16px; color: var(--gray); font-size: 0.9rem;">
<i class="fas fa-shield-alt"></i> All transactions are secured with bank-grade encryption
</p>
</div>
</div>

<!-- Transfer Modal -->
<div id="transfer-modal" class="modal">
<div class="modal-content">
<span class="close-modal" onclick="closeModal('transfer-modal')">&times;</span>
<h3 style="margin-bottom: 24px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px;">
<i class="fas fa-exchange-alt"></i> Transfer Funds
</h3>
<div class="form-group">
<label><i class="fas fa-arrow-up me-2"></i> From (Source Portfolio)</label>
<select id="transfer-from" class="form-control"></select>
</div>
<div class="form-group">
<label><i class="fas fa-arrow-down me-2"></i> To (Destination Portfolio)</label>
<select id="transfer-to" class="form-control"></select>
</div>
<div class="form-group">
<label><i class="fas fa-coins me-2"></i> Amount (UGX)</label>
<input type="number" id="transfer-amount" class="form-control" placeholder="Available: UGX 0">
</div>
<button class="btn btn-primary btn-block" onclick="processTransaction('transfer')" id="transfer-btn">
<i class="fas fa-paper-plane"></i> Verify & Transfer
</button>
</div>
</div>

<!-- Withdraw Modal -->
<div id="withdraw-modal" class="modal">
<div class="modal-content">
<span class="close-modal" onclick="closeModal('withdraw-modal')">&times;</span>
<h3 style="margin-bottom: 24px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px;">
<i class="fas fa-minus-circle"></i> Withdraw Funds
</h3>
<div class="form-group">
<label><i class="fas fa-wallet me-2"></i> Select Portfolio</label>
<select id="withdraw-type" class="form-control"></select>
</div>
<div class="form-group">
<label><i class="fas fa-coins me-2"></i> Amount (UGX)</label>
<input type="number" id="withdraw-amount" class="form-control" placeholder="Available: UGX 0">
</div>
<button class="btn btn-danger btn-block" onclick="processTransaction('withdraw')" id="withdraw-btn">
<i class="fas fa-money-bill-wave"></i> Withdraw Funds
</button>
</div>
</div>

<!-- Print Confirmation Modal -->
<div id="print-confirm-modal" class="modal">
<div class="modal-content">
<span class="close-modal" onclick="closeModal('print-confirm-modal')">&times;</span>
<h3 style="margin-bottom: 24px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px;">
<i class="fas fa-print"></i> Print Receipt
</h3>
<div style="text-align: center; padding: 20px 0;">
<i class="fas fa-receipt" style="font-size: 4rem; color: var(--primary); margin-bottom: 20px;"></i>
<p style="font-size: 1.1rem; margin-bottom: 24px; color: var(--gray);">
Would you like to print your transaction receipt?
</p>
<div class="flex-center" style="gap: 16px;">
<button class="btn btn-success print-confirm-btn" onclick="confirmPrint(true)">
<i class="fas fa-check"></i> Yes, Print
</button>
<button class="btn btn-outline print-confirm-btn" onclick="confirmPrint(false)">
<i class="fas fa-times"></i> No, Skip
</button>
</div>
</div>
</div>
</div>

<!-- QR Code Transaction Receipt Modal -->
<div id="qr-receipt-modal" class="modal">
<div class="modal-content" style="max-width: 480px;">
<span class="close-modal" onclick="closeModal('qr-receipt-modal')">&times;</span>
<h3 style="margin-bottom: 20px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px;">
<i class="fas fa-qrcode"></i> Transaction Receipt
</h3>
<div class="qr-container">
<div class="qr-instruction">
<i class="fas fa-info-circle"></i>
<span>Scan this QR code to verify transaction details</span>
</div>
<div id="qrcode"></div>
<div class="qr-details">
<div class="qr-detail-row">
<span class="qr-detail-label">Transaction ID:</span>
<span class="qr-detail-value" id="qr-txn-id">TXN-2024-001</span>
</div>
<div class="qr-detail-row">
<span class="qr-detail-label">Date & Time:</span>
<span class="qr-detail-value" id="qr-date">Feb 22, 2024 14:30</span>
</div>
<div class="qr-detail-row">
<span class="qr-detail-label">Member:</span>
<span class="qr-detail-value" id="qr-member">John Doe</span>
</div>
<div class="qr-detail-row">
<span class="qr-detail-label">Amount:</span>
<span class="qr-detail-value" id="qr-amount">UGX 50,000</span>
</div>
<div class="qr-detail-row">
<span class="qr-detail-label">Status:</span>
<span class="qr-detail-value" style="color: var(--success);">‚úì Completed</span>
</div>
</div>
<button class="btn btn-primary btn-block" onclick="printReceipt()">
<i class="fas fa-print"></i> Print Receipt
</button>
<p style="margin-top: 16px; color: var(--gray); font-size: 0.9rem; text-align: center;">
<i class="fas fa-lock"></i> This QR code contains encrypted transaction data
</p>
</div>
</div>
</div>

<!-- Statement/Receipt Modal -->
<div id="statement-modal" class="modal">
<div class="modal-content" style="max-width: 800px;">
<span class="close-modal" onclick="closeModal('statement-modal')">&times;</span>
<h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
<i class="fas fa-history"></i> Transaction Statements
</h3>
<div style="max-height: 400px; overflow-y: auto; margin: 15px 0; border: 1px solid #e2e8f0; border-radius: var(--radius-md);">
<table style="width: 100%; border-collapse: collapse;">
<thead style="position: sticky; top: 0; background: #f8fafc; z-index: 10;">
<tr style="text-align: left; border-bottom: 2px solid #e2e8f0;">
<th style="padding: 14px 16px; font-weight: 600;">Date</th>
<th style="padding: 14px 16px; font-weight: 600;">Type</th>
<th style="padding: 14px 16px; font-weight: 600;">Details</th>
<th style="padding: 14px 16px; font-weight: 600; text-align: right;">Amount</th>
<th style="padding: 14px 16px; font-weight: 600; text-align: center;">Action</th>
</tr>
</thead>
<tbody id="statement-body"></tbody>
</table>
</div>
<div class="flex" style="margin-top: 20px; justify-content: flex-end;">
<button class="btn btn-outline" onclick="closeModal('statement-modal')">
<i class="fas fa-times"></i> Close
</button>
<button class="btn btn-primary" onclick="exportStatements()">
<i class="fas fa-file-export"></i> Export All
</button>
</div>
</div>
</div>

<!-- Toast Notification Container -->
<div id="toast-container"></div>

<!-- Alarm Indicator -->
<div id="alarm-indicator" class="alarm-indicator hidden">
<i class="fas fa-bell"></i>
<span id="alarm-message">Transaction Completed!</span>
</div>

<!-- Hidden Receipt Area for Printing -->
<div id="receipt-area">
<div class="receipt-container">
<div class="receipt-header">
<div class="receipt-logo">KLCDO Development Finance System (KDFS)</div>
<div>Smart Investment Portal</div>
<div style="margin-top: 8px; font-weight: 600; color: var(--primary);">Transaction Receipt</div>
</div>
<div class="receipt-detail">
<span>Date:</span>
<span id="rec-date">Feb 22, 2024</span>
</div>
<div class="receipt-detail">
<span>Member:</span>
<span id="rec-member">John Doe</span>
</div>
<div class="receipt-detail">
<span>ID:</span>
<span id="rec-id">KLCDO-12345</span>
</div>
<div class="receipt-detail">
<span>Transaction ID:</span>
<span id="rec-txn-id">TXN-2024-001</span>
</div>
<div style="margin: 20px 0; border-top: 2px dashed #e2e8f0; border-bottom: 2px dashed #e2e8f0; padding: 16px 0;">
<div class="receipt-detail" style="font-size: 1.2rem; font-weight: 600;">
<span>Type:</span>
<span id="rec-type">Deposit to Cash</span>
</div>
</div>
<div class="receipt-amount" id="rec-amount">UGX 50,000</div>
<div class="receipt-qr">
<div id="receipt-qrcode"></div>
</div>
<div class="receipt-footer">
<div>‚úì Transaction Completed Successfully</div>
<div style="margin-top: 8px;">Secured by KLCDO Bank</div>
<div style="margin-top: 4px; font-size: 0.85rem;">Thank you for investing with us.</div>
<div style="margin-top: 12px; font-weight: 600; color: var(--primary);">www.klcdobank.com</div>
</div>
</div>
</div>

<script>
// State Management
let currentUser = null;
let isLoginMode = true;
// UPDATED: All portfolio values start at ZERO
let portfolios = [
{ name: 'Labor', value: 0, icon: 'üí™', color: '#4361ee' },
{ name: 'Cash', value: 0, icon: 'üíµ', color: '#06d6a0' },
{ name: 'Material', value: 0, icon: 'üì¶', color: '#7209b7' },
{ name: 'Schools', value: 0, icon: 'üéì', color: '#118ab2' },
{ name: 'Hospitals', value: 0, icon: 'üè•', color: '#ef476f' },
{ name: 'Business', value: 0, icon: 'üíº', color: '#ffd166' }
];
let transactions = [];
let profileImage = null;
let transactionCounter = 1000;
let pendingTransaction = null; // Store transaction for print confirmation

// Audio Context for Alarm Sounds
const audioContext = new (window.AudioContext || window.webkitAudioContext)();

// Play Alarm Sound Function
function playAlarmSound(type) {
try {
const oscillator = audioContext.createOscillator();
const gainNode = audioContext.createGain();

oscillator.connect(gainNode);
gainNode.connect(audioContext.destination);

if (type === 'login') {
// Login sound - pleasant chime
oscillator.type = 'sine';
oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
oscillator.start(audioContext.currentTime);
oscillator.stop(audioContext.currentTime + 0.5);
} else if (type === 'transaction') {
// Transaction sound - success beep
oscillator.type = 'sine';
oscillator.frequency.setValueAtTime(880, audioContext.currentTime); // A5
oscillator.frequency.setValueAtTime(1100, audioContext.currentTime + 0.1); // C#6
gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
oscillator.start(audioContext.currentTime);
oscillator.stop(audioContext.currentTime + 0.4);
}
} catch (e) {
console.log('Audio not supported');
}
}

// Show Alarm Indicator
function showAlarmIndicator(message) {
const indicator = document.getElementById('alarm-indicator');
document.getElementById('alarm-message').innerText = message;
indicator.classList.remove('hidden');
setTimeout(() => {
indicator.classList.add('hidden');
}, 3000);
}

// DOM Elements
const authForm = document.getElementById('auth-form');
const authTitle = document.getElementById('auth-title');
const authToggle = document.getElementById('auth-toggle');
const nameGroup = document.getElementById('name-group');
const authSubmit = document.getElementById('auth-submit');

// Live Clock Update
function updateLiveClock() {
const clock = document.getElementById('live-clock');
if (clock) {
const now = new Date();
clock.innerText = now.toLocaleString('en-UG', {
year: 'numeric',
month: 'short',
day: 'numeric',
hour: '2-digit',
minute: '2-digit',
second: '2-digit'
});
}
}
setInterval(updateLiveClock, 1000);

// Auth Logic
function toggleAuthMode() {
isLoginMode = !isLoginMode;
authTitle.innerHTML = isLoginMode ?
'<i class="fas fa-sign-in-alt"></i> Member Login' :
'<i class="fas fa-user-plus"></i> Create Account';
authToggle.innerHTML = isLoginMode ?
'<i class="fas fa-user-plus"></i> Create Account' :
'<i class="fas fa-sign-in-alt"></i> Back to Login';
nameGroup.classList.toggle('hidden', isLoginMode);
// Update button text
authSubmit.innerHTML = isLoginMode ?
'<i class="fas fa-sign-in-alt"></i> Sign In' :
'<i class="fas fa-user-plus"></i> Create Account';
}

authToggle.addEventListener('click', function(e) {
e.preventDefault();
toggleAuthMode();
});

authForm.addEventListener('submit', function(e) {
e.preventDefault();
// Show loading state
authSubmit.classList.add('loading');
authSubmit.disabled = true;
const name = document.getElementById('reg-name').value;
const id = document.getElementById('member-id').value;
const password = document.getElementById('password').value;

// Simple validation
if(!isLoginMode && !name) {
showToast('error', 'Validation Error', 'Please enter your full name');
resetAuthButton();
return;
}
if(password.length < 6) {
showToast('error', 'Validation Error', 'Password must be at least 6 characters');
resetAuthButton();
return;
}

// Simulate API call delay
setTimeout(() => {
// Simulate Login/Register
currentUser = {
name: name || 'Alex Morgan',
id: id || 'KLCDO-' + Math.floor(10000 + Math.random() * 90000),
email: name ? name.toLowerCase().replace(/\s+/g, '.') + '@klcdo.com' : 'member@klcdo.com'
};

// Switch to dashboard
document.getElementById('auth-section').classList.add('hidden');
document.getElementById('dashboard-section').classList.remove('hidden');
document.getElementById('nav-links').classList.remove('hidden');

// Update UI with user data
document.getElementById('dash-name').innerText = currentUser.name;
document.getElementById('dash-id').innerText = currentUser.id;
document.getElementById('header-member-name').innerText = `Welcome, ${currentUser.name.split(' ')[0]} üëã`;

// Set profile initial
document.getElementById('display-profile-pic').innerText = currentUser.name.charAt(0).toUpperCase();
updatePortfolioUI();
populateSelects();

// UPDATED: Play alarm sound for new member login
playAlarmSound('login');
showAlarmIndicator(isLoginMode ? 'Welcome Back!' : 'New Member Registered!');

// Show success toast
showToast('success',
isLoginMode ? 'Welcome Back!' : 'Account Created!',
isLoginMode ? 'You\'ve successfully logged in to your account' : 'Your account has been created successfully'
);

// Reset auth button
resetAuthButton();
}, 1200);
});

function resetAuthButton() {
authSubmit.classList.remove('loading');
authSubmit.disabled = false;
}

function logout() {
// Show confirmation
if(confirm('Are you sure you want to logout?')) {
showToast('success', 'Logged Out', 'You have been securely logged out');
setTimeout(() => {
location.reload();
}, 1000);
}
}

// Profile Picture
function uploadProfile() {
const fileInput = document.getElementById('profile-upload');
if (fileInput.files && fileInput.files[0]) {
const reader = new FileReader();
reader.onload = function(e) {
profileImage = e.target.result;
document.getElementById('display-profile-pic').style.backgroundImage = `url(${profileImage})`;
document.getElementById('display-profile-pic').style.backgroundSize = 'cover';
document.getElementById('display-profile-pic').style.backgroundPosition = 'center';
document.getElementById('display-profile-pic').innerText = '';
document.getElementById('preview-profile-pic').style.backgroundImage = `url(${profileImage})`;
document.getElementById('preview-profile-pic').style.backgroundSize = 'cover';
document.getElementById('preview-profile-pic').style.backgroundPosition = 'center';
document.getElementById('preview-profile-pic').innerText = '';
closeModal('profile-modal');
showToast('success', 'Profile Updated', 'Your profile picture has been updated successfully');
}
reader.readAsDataURL(fileInput.files[0]);
} else {
showToast('warning', 'No File Selected', 'Please select an image file to upload');
}
}

// Portfolio Logic
function getTotalValue() {
return portfolios.reduce((sum, p) => sum + p.value, 0);
}

function updatePortfolioUI() {
const total = getTotalValue();
document.getElementById('total-portfolio').innerText = 'UGX ' + total.toLocaleString();
const grid = document.getElementById('portfolio-grid');
grid.innerHTML = '';
portfolios.forEach(p => {
const percentage = total > 0 ? ((p.value / total) * 100).toFixed(1) : 0;
// Simulate realistic growth
const growth = (Math.random() * 8 - 2).toFixed(1);
const isPositive = parseFloat(growth) >= 0;
const growthClass = isPositive ? 'growth-positive' : 'growth-negative';
const growthIcon = isPositive ? '<i class="fas fa-arrow-up"></i>' : '<i class="fas fa-arrow-down"></i>';
grid.innerHTML += `
<div class="card portfolio-card">
<div class="portfolio-header">
<div style="display: flex; align-items: center;">
<div class="portfolio-icon" style="background: ${p.color}20; color: ${p.color}">
${p.icon}
</div>
<h4>${p.name}</h4>
</div>
<strong style="font-size: 1.2rem;">UGX ${p.value.toLocaleString()}</strong>
</div>
<div class="percentage-text">
<span>${percentage}% of Total Portfolio</span>
<span>${percentage}%</span>
</div>
<div class="percentage-bar">
<div class="percentage-fill" style="width: ${percentage}%; background: ${p.color}"></div>
</div>
<div class="growth-indicator ${growthClass}">
${growthIcon} This Month: ${Math.abs(growth)}%
</div>
</div>
`;
});
}

function populateSelects() {
const types = portfolios.map(p => p.name);
const fromSelect = document.getElementById('transfer-from');
const toSelect = document.getElementById('transfer-to');
const withdrawSelect = document.getElementById('withdraw-type');
fromSelect.innerHTML = '';
toSelect.innerHTML = '';
withdrawSelect.innerHTML = '';
types.forEach((t, index) => {
const portfolio = portfolios.find(p => p.name === t);
fromSelect.innerHTML += `<option value="${t}">${portfolio.icon} ${t} (UGX ${portfolio.value.toLocaleString()})</option>`;
toSelect.innerHTML += `<option value="${t}">${portfolio.icon} ${t}</option>`;
withdrawSelect.innerHTML += `<option value="${t}">${portfolio.icon} ${t} (UGX ${portfolio.value.toLocaleString()})</option>`;
});
// Update available amount placeholder
document.getElementById('transfer-amount').placeholder = `Available: UGX ${portfolios[0].value.toLocaleString()}`;
document.getElementById('withdraw-amount').placeholder = `Available: UGX ${portfolios[0].value.toLocaleString()}`;
// Update on change
fromSelect.addEventListener('change', function() {
const selected = portfolios.find(p => p.name === this.value);
document.getElementById('transfer-amount').placeholder = `Available: UGX ${selected.value.toLocaleString()}`;
document.getElementById('transfer-amount').max = selected.value;
});
withdrawSelect.addEventListener('change', function() {
const selected = portfolios.find(p => p.name === this.value);
document.getElementById('withdraw-amount').placeholder = `Available: UGX ${selected.value.toLocaleString()}`;
document.getElementById('withdraw-amount').max = selected.value;
});
}

// Transaction Logic
function processTransaction(type) {
let amount = 0;
let details = '';
let success = false;
let button, modalId;

// Set button and modal based on type
if (type === 'deposit') {
button = document.getElementById('deposit-btn');
modalId = 'deposit-modal';
amount = parseFloat(document.getElementById('deposit-amount').value);
const pType = document.getElementById('deposit-type').value;
if (!amount || amount < 1000) {
showToast('warning', 'Invalid Amount', 'Minimum deposit is UGX 1,000');
return;
}
const p = portfolios.find(x => x.name === pType);
p.value += amount;
details = `Deposit to ${pType}`;
success = true;
}
else if (type === 'transfer') {
button = document.getElementById('transfer-btn');
modalId = 'transfer-modal';
amount = parseFloat(document.getElementById('transfer-amount').value);
const from = document.getElementById('transfer-from').value;
const to = document.getElementById('transfer-to').value;
const pFrom = portfolios.find(x => x.name === from);
const pTo = portfolios.find(x => x.name === to);
if (!amount || amount <= 0) {
showToast('warning', 'Invalid Amount', 'Please enter a valid transfer amount');
return;
}
if (pFrom.value < amount) {
showToast('error', 'Insufficient Funds', `You only have UGX ${pFrom.value.toLocaleString()} in ${from}`);
return;
}
pFrom.value -= amount;
pTo.value += amount;
details = `Transfer from ${from} to ${to}`;
success = true;
}
else if (type === 'withdraw') {
button = document.getElementById('withdraw-btn');
modalId = 'withdraw-modal';
amount = parseFloat(document.getElementById('withdraw-amount').value);
const pType = document.getElementById('withdraw-type').value;
const p = portfolios.find(x => x.name === pType);
if (!amount || amount <= 0) {
showToast('warning', 'Invalid Amount', 'Please enter a valid withdrawal amount');
return;
}
if (p.value < amount) {
showToast('error', 'Insufficient Funds', `You only have UGX ${p.value.toLocaleString()} in ${pType}`);
return;
}
p.value -= amount;
details = `Withdrawal from ${pType}`;
success = true;
}

if (success) {
// Show loading on button
button.classList.add('loading');
button.disabled = true;

// Simulate processing delay
setTimeout(() => {
// Generate transaction record with UP-TO-DATE timestamp
const now = new Date();
const txnId = `TXN-${now.getFullYear()}-${String(transactionCounter++).padStart(4, '0')}`;
const txn = {
id: txnId,
date: now.toLocaleString('en-UG', {
year: 'numeric',
month: 'short',
day: 'numeric',
hour: '2-digit',
minute: '2-digit',
second: '2-digit'
}),
timestamp: now.toISOString(),
type: type.toUpperCase(),
details: details,
amount: amount,
member: currentUser.name,
memberId: currentUser.id
};
transactions.unshift(txn);
updatePortfolioUI();

// Close modal
closeModal(modalId);

// UPDATED: Play alarm sound for transaction
playAlarmSound('transaction');
showAlarmIndicator('Transaction Completed Successfully!');

// Show success toast
const messages = {
'deposit': { title: 'Deposit Successful!', message: `UGX ${amount.toLocaleString()} added to your portfolio` },
'transfer': { title: 'Transfer Complete!', message: `UGX ${amount.toLocaleString()} transferred successfully` },
'withdraw': { title: 'Withdrawal Processed!', message: `UGX ${amount.toLocaleString()} withdrawn to your account` }
};
showToast('success', messages[type].title, messages[type].message);

// Store transaction for print confirmation
pendingTransaction = txn;

// UPDATED: Ask user if they want to print receipt
setTimeout(() => {
openModal('print-confirm-modal');
}, 500);

// Reset button
button.classList.remove('loading');
button.disabled = false;

// Reset form
if(type === 'deposit') document.getElementById('deposit-amount').value = '';
if(type === 'transfer') document.getElementById('transfer-amount').value = '';
if(type === 'withdraw') document.getElementById('withdraw-amount').value = '';
}, 1500);
}
}

// Print Confirmation
function confirmPrint(shouldPrint) {
closeModal('print-confirm-modal');
if (shouldPrint && pendingTransaction) {
showQRReceipt(pendingTransaction);
} else {
showToast('info', 'Receipt Skipped', 'You can print receipts from transaction history anytime');
}
pendingTransaction = null;
}

// QR Code Receipt
function showQRReceipt(txn) {
// Update QR modal details
document.getElementById('qr-txn-id').innerText = txn.id;
document.getElementById('qr-date').innerText = txn.date;
document.getElementById('qr-member').innerText = txn.member;
document.getElementById('qr-amount').innerText = `UGX ${txn.amount.toLocaleString()}`;

// Clear previous QR code
document.getElementById('qrcode').innerHTML = '';

// Generate QR code with transaction data
const qrData = JSON.stringify({
txnId: txn.id,
member: txn.member,
memberId: txn.memberId,
amount: txn.amount,
currency: 'UGX',
type: txn.type,
details: txn.details,
timestamp: txn.timestamp,
bank: 'KLCDO Bank',
verifyUrl: `https://klcdobank.com/verify/${txn.id}`
});
new QRCode(document.getElementById("qrcode"), {
text: qrData,
width: 180,
height: 180,
correctLevel: QRCode.CorrectLevel.H
});

// Also generate for print receipt
document.getElementById('receipt-qrcode').innerHTML = '';
new QRCode(document.getElementById("receipt-qrcode"), {
text: qrData,
width: 120,
height: 120,
correctLevel: QRCode.CorrectLevel.H
});

// Show the modal after a small delay for animation
setTimeout(() => {
openModal('qr-receipt-modal');
}, 300);
}

// Statements & Receipts
function viewStatements() {
const tbody = document.getElementById('statement-body');
tbody.innerHTML = '';
if(transactions.length === 0) {
tbody.innerHTML = `
<tr>
<td colspan="5" style="text-align:center; padding: 30px; color: var(--gray);">
<i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 12px; opacity: 0.5;"></i>
<div>No transactions yet</div>
<div style="font-size: 0.9rem; margin-top: 4px;">Your transaction history will appear here</div>
</td>
</tr>
`;
} else {
transactions.forEach((t, index) => {
const amountClass = t.type === 'WITHDRAW' ? 'growth-negative' : 'growth-positive';
const amountPrefix = t.type === 'WITHDRAW' ? '-' : '+';
tbody.innerHTML += `
<tr style="border-bottom: 1px solid #f1f5f9; transition: background 0.2s;">
<td style="padding: 14px 16px; font-size: 0.95rem;">${t.date}</td>
<td style="padding: 14px 16px;">
<span style="background: ${t.type === 'DEPOSIT' ? 'rgba(16, 185, 129, 0.1)' : t.type === 'WITHDRAW' ? 'rgba(239, 71, 111, 0.1)' : 'rgba(67, 97, 238, 0.1)'};
color: ${t.type === 'DEPOSIT' ? 'var(--success)' : t.type === 'WITHDRAW' ? 'var(--danger)' : 'var(--primary)'};
padding: 4px 10px; border-radius: 20px; font-weight: 500; font-size: 0.9rem;">
${t.type}
</span>
</td>
<td style="padding: 14px 16px; font-size: 0.95rem;">${t.details}</td>
<td style="padding: 14px 16px; text-align: right; font-weight: 600; color: ${t.type === 'WITHDRAW' ? 'var(--danger)' : 'var(--success)'};">
${amountPrefix} UGX ${t.amount.toLocaleString()}
</td>
<td style="padding: 14px 16px; text-align: center;">
<button class="btn btn-sm btn-outline" style="padding: 6px 12px;" onclick="printSpecificReceipt(${index})">
<i class="fas fa-qrcode"></i>
</button>
</td>
</tr>
`;
});
}
openModal('statement-modal');
}

function printSpecificReceipt(index) {
const txn = transactions[index];
// Update receipt area
document.getElementById('rec-date').innerText = txn.date;
document.getElementById('rec-member').innerText = txn.member;
document.getElementById('rec-id').innerText = txn.memberId;
document.getElementById('rec-txn-id').innerText = txn.id;
document.getElementById('rec-type').innerText = txn.details;
document.getElementById('rec-amount').innerText = 'UGX ' + txn.amount.toLocaleString();

// Generate QR for print
document.getElementById('receipt-qrcode').innerHTML = '';
const qrData = JSON.stringify({
txnId: txn.id,
member: txn.member,
memberId: txn.memberId,
amount: txn.amount,
currency: 'UGX',
type: txn.type,
details: txn.details,
timestamp: txn.timestamp,
bank: 'KLCDO Bank',
verifyUrl: `https://klcdobank.com/verify/${txn.id}`
});
new QRCode(document.getElementById("receipt-qrcode"), {
text: qrData,
width: 120,
height: 120,
correctLevel: QRCode.CorrectLevel.H
});

// Close statement modal and print
closeModal('statement-modal');
setTimeout(() => {
window.print();
showToast('success', 'Receipt Printed', 'Your transaction receipt has been sent to printer');
}, 500);
}

function printReceipt() {
window.print();
showToast('success', 'Receipt Printed', 'Your transaction receipt has been sent to printer');
}

// Reports
function downloadReport(period) {
const date = new Date().toLocaleDateString('en-UG');
const content = `KLCDO Bank ${period.toUpperCase()} Report
Generated: ${new Date().toLocaleString('en-UG')}
Member: ${currentUser.name}
ID: ${currentUser.id}
Email: ${currentUser.email}
=== PORTFOLIO SUMMARY ===
Total Portfolio Value: UGX ${getTotalValue().toLocaleString()}
=== PORTFOLIO BREAKDOWN ===
${portfolios.map(p => `${p.name}: UGX ${p.value.toLocaleString()} (${((p.value/getTotalValue())*100).toFixed(1)}%)`).join('\n')}
=== RECENT TRANSACTIONS ===
${transactions.slice(0, 10).map(t => `${t.date} | ${t.type} | ${t.details} | UGX ${t.amount.toLocaleString()}`).join('\n') || 'No transactions yet'}
=== VERIFICATION ===
All transactions can be verified using the QR code on official receipts.
Visit: https://klcdobank.com/verify
---
This is an official document from KLCDO Bank.
Secured with bank-grade encryption.
`;
const blob = new Blob([content], { type: 'text/plain' });
const url = window.URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = `KLCDO_${period.toUpperCase()}_Report_${Date.now()}.txt`;
a.click();
window.URL.revokeObjectURL(url);
showToast('success', 'Report Downloaded', `${period.charAt(0).toUpperCase() + period.slice(1)} report has been downloaded`);
}

function exportStatements() {
if(transactions.length === 0) {
showToast('warning', 'No Data', 'No transactions to export');
return;
}
const csvContent = "data:text/csv;charset=utf-8,"
+ "Date,Type,Details,Amount (UGX),Transaction ID\n"
+ transactions.map(t =>
`"${t.date}","${t.type}","${t.details}","${t.amount}","${t.id}"`
).join("\n");
const encodedUri = encodeURI(csvContent);
const link = document.createElement("a");
link.setAttribute("href", encodedUri);
link.setAttribute("download", `KLCDO_Transactions_${new Date().toISOString().slice(0,10)}.csv`);
document.body.appendChild(link);
link.click();
document.body.removeChild(link);
showToast('success', 'Export Complete', 'Transaction history exported to CSV');
}

function showCardDetails() {
showToast('success', 'Smart Card Details', 'Your KLCDO Smart Card details have been sent to your registered email');
}

// UI Helpers
function openModal(id) {
document.getElementById(id).classList.add('active');
document.body.style.overflow = 'hidden'; // Prevent background scrolling
}

function closeModal(id) {
document.getElementById(id).classList.remove('active');
document.body.style.overflow = '';
}

// Enhanced Toast Notification System
function showToast(type, title, message) {
const container = document.getElementById('toast-container');
const toast = document.createElement('div');
toast.className = `toast ${type}`;
const icons = {
'success': 'fas fa-check-circle',
'error': 'fas fa-exclamation-circle',
'warning': 'fas fa-exclamation-triangle',
'info': 'fas fa-info-circle'
};
toast.innerHTML = `
<i class="${icons[type] || 'fas fa-info-circle'}"></i>
<div class="toast-content">
<span class="toast-title">${title}</span>
<span class="toast-message">${message}</span>
</div>
`;
container.appendChild(toast);
// Trigger animation
setTimeout(() => {
toast.classList.add('show');
}, 100);
// Auto remove after 5 seconds
setTimeout(() => {
toast.classList.remove('show');
setTimeout(() => {
if(toast.parentNode) {
container.removeChild(toast);
}
}, 400);
}, 5000);
// Allow manual close
toast.addEventListener('click', (e) => {
if(e.target === toast || e.target.closest('.toast-content')) {
toast.classList.remove('show');
setTimeout(() => {
if(toast.parentNode) {
container.removeChild(toast);
}
}, 400);
}
});
}

// Close modal when clicking outside
document.querySelectorAll('.modal').forEach(modal => {
modal.addEventListener('click', (e) => {
if(e.target === modal) {
closeModal(modal.id);
}
});
});

// Close modals with Escape key
document.addEventListener('keydown', (e) => {
if(e.key === 'Escape') {
document.querySelectorAll('.modal.active').forEach(modal => {
closeModal(modal.id);
});
}
});

// Initialize with ZERO values (no sample data)
document.addEventListener('DOMContentLoaded', () => {
// UPDATED: No sample transactions - start fresh with zero portfolio
// Initialize portfolio UI
updatePortfolioUI();

// Show welcome toast for demo
setTimeout(() => {
showToast('success', 'Welcome to KLCDO Bank', 'Your secure investment portal is ready to use');
}, 1000);

// Start live clock
updateLiveClock();
});
</script>
</body>
</html>